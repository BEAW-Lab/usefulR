% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/extract_era5.R
\name{extract_era5}
\alias{extract_era5}
\title{Download and Summarise ERA5 Point Data from the Copernicus Climate Data Store}
\usage{
extract_era5(
  start_date,
  end_date,
  coords,
  variables,
  token,
  summarise_fun = mean,
  temp_dir = "era5_downloads"
)
}
\arguments{
\item{start_date}{Character or Date. Start of the time window
(e.g. `"2020-01-01"`).}

\item{end_date}{Character or Date. End of the time window
(e.g. `"2020-01-31"`).}

\item{coords}{A data frame containing point coordinates with columns:
\describe{
  \item{lon}{Longitude in decimal degrees.}
  \item{lat}{Latitude in decimal degrees.}
}}

\item{variables}{Character vector of ERA5 variable names to download.
Defaults to `c("2m_temperature")`.}

\item{token}{Character. Your CDS API token.}

\item{summarise_fun}{A function used to summarise hourly values across the
entire time window. Defaults to `mean`. Must accept a numeric vector and
return a single numeric value. Can be base R functions or custom functions.}

\item{temp_dir}{Character. Directory where temporary NetCDF files will be
stored. Defaults to `"era5_temp_downloads"`. Will be created if missing.}
}
\value{
A data frame with one row per coordinate and one column per
  summarised climate variable. Output columns include:
  \itemize{
    \item{`lat`, `lon` — original coordinate values}
    \item{One column per variable summarised over the time window}
  }
}
\description{
This function downloads ERA5 reanalysis data for one or more geographic
coordinates by requesting a small spatial window around each point  
(ERA5 does not support point queries directly). It retrieves hourly data
for a user-defined time range and list of climate variables using the
Copernicus Climate Data Store (CDS) API via the \pkg{ecmwfr} package.
}
\details{
After downloading and extracting the nearest ERA5 grid cell for each point,
the function summarises all hourly values into one aggregated value per
variable, using a user-defined summary function (e.g., `mean`, `sum`,
`median`, `max`, custom functions, etc.). This is especially useful for
long time periods such as monthly or seasonal summaries.


ERA5 provides hourly climate data at ~0.25° resolution. Because the CDS API
does not support point extraction directly, the function automatically builds
a small bounding box (0.3° buffer) around each coordinate to ensure that the
corresponding ERA5 grid cell is included. The nearest cell is extracted using
the \pkg{terra} package.

For long time windows or many points, consider batching multiple coordinates
into a single request, or running the function in parallel.
}
\examples{
\dontrun{
coords <- data.frame(
  lon = c(-3.70, -8.40),
  lat = c(40.42, 43.36)
)

# Monthly mean temperature and precipitation
df <- download_era5_points(
  start_date = "2021-01-01",
  end_date   = "2021-01-31",
  coords     = coords,
  variables  = c("2m_temperature", "total_precipitation"),
  user_id    = "123456",
  token      = "your_cds_token_here",
  summarise_fun = mean
)

# Monthly precipitation sum
df2 <- download_era5_points(
  start_date = "2021-01-01",
  end_date   = "2021-01-31",
  coords     = coords,
  variables  = "total_precipitation",
  user_id    = "123456",
  token      = "your_cds_token_here",
  summarise_fun = sum
)
}

}
